var t=Object.defineProperty,e=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,l=(e,o,a)=>o in e?t(e,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[o]=a,s=(t,s)=>{for(var i in s||(s={}))o.call(s,i)&&l(t,i,s[i]);if(e)for(var i of e(s))a.call(s,i)&&l(t,i,s[i]);return t};import{M as i}from"./modal.cf52bcef.js";import{C as d}from"./ckeditor.1e16c881.js";import{H as r,o as c,c as n,f as p,l as m,I as u,M as h,g,r as b,k as f,F as w,i as v,t as y}from"./vendor.0c547ad4.js";const P={props:["product","isNew","img"],emits:["get-data"],data:()=>({modal:"",tempProduct:{chId:"",chStatus:""},url:"https://api.news-age.tw/",editor:d,imageLoaded:!1,image:{size:"",height:"",width:""},editorConfig:{toolbar:["heading","bold","italic","blockquote","imageUpload","link","|","numberedList","bulletedList","|","undo","redo"]}}),watch:{product(){this.tempProduct=JSON.parse(JSON.stringify(this.product))}},mounted(){this.modal=new i(this.$refs.productModal,{keyboard:!1,backdrop:"static",focus:!1})},methods:{updateProduct(){let t="https://api.news-age.tw/homeBn",e="post";this.isNew||(t=`https://api.news-age.tw/homeBn/${this.tempProduct.id}`,e="put",console.log("put",t),console.log("put的物件",this.product)),console.log("post",this.tempProduct),this.$http[e](t,this.tempProduct).then((t=>{console.log("回傳",t.data.data),r.success(t.data.message),this.$emit("get-data"),this.modal.hide()})).catch((t=>{console.log(t.message)}))},openModal(){this.modal.show()},hideModal(){this.modal.hide()},upload(t,e){const o=e.target.files[0];if(!o||0!==o.type.indexOf("image/"))return;console.log("f",o);let a=new FileReader;a.readAsDataURL(o),a.onload=t=>{let e=new Image;e.onload=()=>{if(this.image.width=e.width,this.image.height=e.height,this.imageLoaded=!0,console.log(this.image),1300!==this.image.width)return r.error(`上傳圖片寬度錯誤，您上傳的寬度是${this.image.width}`),this.imageLoaded=!1,void(this.$refs.pathClear.value="");if(700!==this.image.height)return r.error(`上傳圖片高度錯誤，您上傳的高度是${this.image.height}`),this.imageLoaded=!1,void(this.$refs.pathClear.value="");if(console.log(this.imageLoaded),this.imageLoaded){const t=new FormData;t.append("imgSingle",o),this.$http.post("https://api.news-age.tw/imgUpload",t).then((t=>{this.tempProduct.homeFront=t.data,console.log("回傳",t.data),this.$refs.pathClear.value="",r.success("上傳圖片成功")})).catch((t=>{console.dir(t)}))}},e.src=t.target.result},a.onerror=t=>{console.error(t)}}}},x={id:"productModal",ref:"productModal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},k={class:"modal-dialog modal-xl"},L={class:"modal-content border-0"},M={id:"productModalLabel",class:"modal-title text-center"},$={key:0},C={key:1,style:{color:"#000"}},I=p("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),N={class:"modal-body"},O={class:"row"},F={class:"col-sm-4"},j={class:"mb-3"},S=p("label",{for:"uploadImg",class:"form-label"},[g(" 新增圖片"),p("span",{class:"btn-danger ms-2 pt-1 pb-1 pe-1 ps-1"},"請上傳1300x700 (px)")],-1),U={class:"col-sm-8"},_={class:"form-floating mb-3"},D=p("label",{for:"title",class:"form-label"},"標題",-1),T={class:"row"},B={class:"mb-3 col-md"},V={class:"form-floating"},G=p("label",{for:"category",class:"form-label"},"連結",-1),J={class:"mb-3"},R={class:"form-floating"},q=p("label",{for:"description",class:"form-label"},"簡短敘述文",-1),z=p("div",{class:"mb-3"},[p("div",{class:"form-floating"})],-1),A={class:"modal-footer"},E=p("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);P.render=function(t,e,o,a,l,s){return c(),n("div",x,[p("div",k,[p("div",L,[p("div",{class:[o.isNew?"bg-primary":"bg-warning","modal-header text-white"]},[p("h5",M,[o.isNew?(c(),n("span",$,"新增文章")):(c(),n("span",C,"編輯文章"))]),I],2),p("div",N,[p("div",O,[p("div",F,[p("div",j,[S,p("input",{accept:"image/*",type:"file",class:"form-control mb-3",id:"uploadImg",ref:"pathClear",onChange:e[1]||(e[1]=t=>s.upload("main",t))},null,544),p("div",null,[p("img",{src:l.tempProduct.homeFront,class:"img-fluid mb-3"},null,8,["src"])]),l.tempProduct.homeFront?(c(),n("button",{key:0,class:"btn btn-outline-danger btn-sm d-block w-100",onClick:e[2]||(e[2]=t=>l.tempProduct.homeFront="")},"刪除檔案")):m("",!0)])]),p("div",U,[p("div",_,[u(p("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":e[3]||(e[3]=t=>l.tempProduct.title=t)},null,512),[[h,l.tempProduct.title]]),D]),p("div",T,[p("div",B,[p("div",V,[u(p("input",{id:"category",type:"text",class:"form-control",placeholder:"請輸入連結","onUpdate:modelValue":e[4]||(e[4]=t=>l.tempProduct.link=t)},null,512),[[h,l.tempProduct.link]]),G])])]),p("div",J,[p("div",R,[u(p("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入簡短敘述文","onUpdate:modelValue":e[5]||(e[5]=t=>l.tempProduct.subtext=t)},null,512),[[h,l.tempProduct.subtext]]),q])]),z])])]),p("div",A,[E,p("button",{type:"button",class:"btn btn-primary","data-bs-dismiss":"modal",onClick:e[6]||(e[6]=(...t)=>s.updateProduct&&s.updateProduct(...t))}," 確認 ")])])])],512)};const H={data:()=>({isLoading:!1,products:[],url:"https://api.news-age.tw",tempProduct:{imagesUrl:[]},isNew:!1}),methods:{getTopList(){this.isLoading=!0,this.$http(`${this.url}/homeBn/`).then((t=>{setTimeout((()=>{this.isLoading=!1}),1e3),this.products=t.data,console.log(this.products)})).catch((t=>{console.log(t)}))},openModal(t,e){"add"===t?(this.tempProduct={chId:7,homeStatus:1,channel:"首頁"},this.isNew=!0,this.$refs.productModal.openModal()):"edit"===t&&(this.tempProduct=s({},e),this.isNew=!1,this.$refs.productModal.openModal())},delItem(t){this.tempProduct=s({},t);let e=`https://api.news-age.tw/chBn/delete/${this.tempProduct.id}`;confirm(`刪除（${this.tempProduct.title}）?`)?(this.tempProduct.deleteStatus=1,this.$http.put(e,this.tempProduct).then((t=>{console.log("回傳",t.data),alert("刪除文章成功"),this.getTopList()}))):alert("你按了取消按鈕")}},components:{ProductModal:P},mounted(){this.getTopList()}},K={class:"crumbs"},Q=p("i",{class:"el-icon-lx-calendar",style:{"margin-right":"5px"}},null,-1),W=g(" 首頁 "),X=g("大版頭"),Y=p("div",{class:"text-center mt-3 mb-3"},[p("h2",null,"首頁-大版頭")],-1),Z={class:"container-fluid"},tt={class:"text-end mt-4"},et=g(" 建立新的文章 "),ot={class:"table"},at=p("thead",null,[p("tr",null,[p("th",{scope:"col",class:"text-center"},"ID"),p("th",{scope:"col"},"頻道"),p("th",{scope:"col"},"圖片"),p("th",{scope:"col"},"標題"),p("th",{scope:"col"},"簡短敘述文"),p("th",{scope:"col"}),p("th",{scope:"col"})])],-1),lt={scope:"row",class:"text-center"},st={width:"300"},it={width:"50"},dt=g("編輯"),rt={width:"50"},ct=g("刪除");H.render=function(t,e,o,a,l,s){const i=b("Loading"),d=b("el-breadcrumb-item"),r=b("el-breadcrumb"),m=b("el-button"),u=b("product-modal");return c(),n("div",null,[p(i,{active:l.isLoading},null,8,["active"]),p("div",K,[p(r,{separator:"/"},{default:f((()=>[p(d,null,{default:f((()=>[Q,W])),_:1}),p(d,null,{default:f((()=>[X])),_:1})])),_:1})]),Y,p("div",Z,[p("div",tt,[p(m,{type:"primary",onClick:e[1]||(e[1]=t=>s.openModal("add"))},{default:f((()=>[et])),_:1})]),p("table",ot,[at,p("tbody",null,[(c(!0),n(w,null,v(l.products,(t=>(c(),n("tr",{key:t.id},[p("th",lt,y(t.id),1),p("td",null,y(t.channel),1),p("td",st,[p("img",{src:t.homeFront,class:"img-fluid"},null,8,["src"])]),p("td",null,y(t.title),1),p("td",null,y(t.subtext),1),p("td",it,[p(m,{plain:"",type:"primary",onClick:e=>s.openModal("edit",t)},{default:f((()=>[dt])),_:2},1032,["onClick"])]),p("td",rt,[p(m,{plain:"",type:"danger",onClick:e=>s.delItem(t)},{default:f((()=>[ct])),_:2},1032,["onClick"])])])))),128))])])]),p(u,{ref:"productModal",product:l.tempProduct,"is-new":l.isNew,onGetData:s.getTopList},null,8,["product","is-new","onGetData"])])};export default H;
